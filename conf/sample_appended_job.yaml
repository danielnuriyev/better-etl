name: test_job
schedule: 0-59 * * * *
retries:
  max: 2
  delay: 1
  backoff: exponential
  lookback_minutes: 5
  notifier:
    package:  better_etl.notifiers.notifier
    class:    Notifier
    config:
      test: test
cache:
  class:  better_etl.caches.S3Cache
  bucket: ...
  path:   dagster/cache
ops:
  - name: get_secret
    package:  better_etl.ops
    class:    AWSSecretsManager
    method:   get_secret
    config:
      secret_name: ...
  - name: get_batches
    after:
      - get_secret
    package:  better_etl.ops
    class:    MySQL
    method:   get_batches
    config:
      host:     ...
      database: ...
      table:    ...
      batch:    1000
      batches:  10
  - name: store_batches
    after:
      - get_batches
    package:  better_etl.ops
    class:    AWSS3
    method:   store
    config:
      bucket: ...
      path:   tables/.../{time.time()}
      condition: >
        batch["data"].size > 0 and
        batch["data"].size < 100000
  - name: find_last_keys
    after:
      - store_batches
    package: better_etl.ops
    class: Utils
    method: find_last_keys
  - name: store_last_keys
    after:
      - find_last_keys
    package: better_etl.ops
    class: Cache
    method: put
    config:
      get_key: last_keys
      put_key: cache_key
